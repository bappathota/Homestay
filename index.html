<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>BappaThota Homestay ‚Äì Booking Tracker</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2980b9">
<link rel="apple-touch-icon" href="icon-192.png">

<style>
body {
  margin:0;
  font-family:system-ui;
  background:
    linear-gradient(rgba(0,0,0,.45), rgba(0,0,0,.45)),
    url("https://raw.githubusercontent.com/bappathota/Homestay/main/bappathota_Background.jpeg");
  background-size:cover;
}
h1 { color:white; text-align:center; }

.container {
  background:white;
  max-width:950px;
  margin:auto;
  padding:20px;
  border-radius:14px;
}

button {
  padding:10px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}

.toggle-btn { background:#2980b9; color:white; }
.confirm-btn { background:#27ae60; color:white; }
.cancel-btn { background:#e74c3c; color:white; }

.add-booking { display:none; }
.add-booking.show { display:block; }

table { width:100%; border-collapse:collapse; }
th,td { padding:8px; border:1px solid #ddd; text-align:center; }
.available { color:green; }
.booked { color:red; }

/* MODAL */
.modal-overlay {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}
.modal-overlay.show { display:flex; }
.modal {
  background:white;
  padding:20px;
  border-radius:12px;
  width:90%;
  max-width:320px;
  text-align:center;
}
.modal-error { color:red; min-height:18px; }
</style>
</head>

<body>

<!-- ADMIN MODAL -->
<div id="adminModal" class="modal-overlay">
  <div class="modal">
    <h3>Admin Login</h3>
    <input id="adminPin" type="password" maxlength="4" inputmode="numeric" placeholder="4-digit PIN">
    <div id="adminError" class="modal-error"></div>
    <button class="confirm-btn" onclick="verifyAdminPin()">Login</button>
    <button class="cancel-btn" onclick="closeAdminModal()">Cancel</button>
  </div>
</div>

<h1>BappaThota Homestay</h1>

<div class="container">

<!-- ‚úÖ ADMIN LOGIN BUTTON -->
<button id="adminLoginBtn" class="toggle-btn" onclick="openAdminModal()">
üîê Admin Login
</button>

<button id="addBookingBtn" class="toggle-btn" style="display:none;">
‚ûï Add New Booking
</button>

<div id="addBookingForm" class="add-booking">
  <input id="guest" placeholder="Guest Name">
  <input id="phone" placeholder="Phone (10 digits)" maxlength="10">
  <input id="guests" type="number" min="1" max="4" placeholder="Guests (max 4)">
  <select id="room"></select>
  <input type="date" id="checkin">
  <input type="date" id="checkout">
  <button class="confirm-btn" onclick="addBooking()">Confirm</button>
</div>

<h3 id="tableTitle">Today's Availability</h3>
<table>
<thead>
<tr><th>Room</th><th>Status</th><th>Guest</th></tr>
</thead>
<tbody id="list"></tbody>
</table>

</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyNAx2Tuc3tn2pLg3OVBJ2Cu5iRPn7EnQ-QrscSUC1JQ9s6hgpTecJiZQuS4M3TYRCJ3g/exec";
const TOTAL_ROOMS = 2;

const guest = document.getElementById("guest");
const phone = document.getElementById("phone");
const guests = document.getElementById("guests");
const room = document.getElementById("room");
const checkin = document.getElementById("checkin");
const checkout = document.getElementById("checkout");
const list = document.getElementById("list");

let adminUnlocked = sessionStorage.getItem("adminUnlocked")==="1";

/* ADMIN */
function openAdminModal(){
  document.getElementById("adminModal").classList.add("show");
  document.getElementById("adminError").textContent="";
}
function closeAdminModal(){
  document.getElementById("adminModal").classList.remove("show");
}
function verifyAdminPin(){
  const pin=document.getElementById("adminPin").value;
  fetch(`${API_URL}?action=verifyAdmin&pin=${pin}`)
    .then(r=>r.json())
    .then(res=>{
      if(!res.success){
        document.getElementById("adminError").textContent="Invalid PIN";
        return;
      }
      adminUnlocked=true;
      sessionStorage.setItem("adminUnlocked","1");
      document.getElementById("addBookingBtn").style.display="block";
      document.getElementById("adminLoginBtn").style.display="none";
      closeAdminModal();
      loadToday();
    });
}

document.getElementById("addBookingBtn").onclick=()=>{
  document.getElementById("addBookingForm").classList.toggle("show");
};

function initRooms(){
  for(let i=1;i<=TOTAL_ROOMS;i++)
    room.innerHTML+=`<option value="${i}">Room ${i}</option>`;
}
function toDateOnly(d){ return new Date(d).toISOString().split("T")[0]; }

async function loadAvailability(date){
  const data=await fetch(API_URL).then(r=>r.json());
  list.innerHTML="";
  for(let i=1;i<=TOTAL_ROOMS;i++){
    const b=data.find(x=>x.room_no==i &&
      date>=toDateOnly(x.check_in)&&date<=toDateOnly(x.check_out));
    list.innerHTML+=`
    <tr>
      <td>Room ${i}</td>
      <td class="${b?'booked':'available'}">${b?'Booked':'Available'}</td>
      <td>${b?.guest_name||'-'}</td>
    </tr>`;
  }
}
function loadToday(){
  loadAvailability(new Date().toISOString().split("T")[0]);
}

async function addBooking(){
  if(!/^\d{10}$/.test(phone.value)) return alert("Invalid phone");
  if(guests.value>4) return alert("Max 4 guests");

  const data=new URLSearchParams({
    guest_name:guest.value,
    phone:phone.value,
    no_of_guests:guests.value,
    room_no:room.value,
    check_in:checkin.value,
    check_out:checkout.value
  });

  const r=await fetch(API_URL,{method:"POST",body:data}).then(r=>r.json());
  if(!r.success) return alert(r.message);
  loadToday();
}

document.addEventListener("DOMContentLoaded",()=>{
  initRooms();
  loadToday();
  if(adminUnlocked){
    document.getElementById("addBookingBtn").style.display="block";
    document.getElementById("adminLoginBtn").style.display="none";
  }
});
</script>

</body>
</html>
